<!DOCTYPE html>
<html>
<head>
    <title>My Video Gallery</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            font-weight: 100;
            background-color: white;
            margin: 0;
            padding: 40px;
            margin-top: 30px;
        }

        .photo-grid {
            margin: 20px auto;
            max-width: 1400px;
        }
        
        .grid-sizer, .grid-item { width: 32%; }
        .gutter-sizer { width: 2%; }
        
        .grid-item {
            margin-bottom: 20px;
            float: left;
            position: relative;
            overflow: hidden;
        }
        
        .video-container {
            position: relative;
            width: 100%;
            height: 0;
            overflow: hidden;
            padding-top: 56.25%; /* Default 16:9 aspect ratio */
        }
        
        .video-container.vertical { padding-top: 177.78%; }
        .video-container.horizontal { padding-top: 56.25%; }
        
        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            background-color: #f0f0f0;
        }
        
        .grid-item img {
            display: block;
            width: 100%;
            height: auto;
        }
        
        .back-link {
            position: fixed;
            top: 40px;
            left: 40px;
            text-decoration: none;
            font-size: 24px;
            z-index: 1000;
            color: black;
        }

        .media-description {
            padding: 8px 0;
            font-size: 14px;
            color: #333;
        }

        @media (max-width: 1200px) {
            .grid-sizer, .grid-item { width: 48%; }
            .gutter-sizer { width: 4%; }
        }

        @media (max-width: 768px) {
            .grid-sizer, .grid-item { width: 100%; }
            .gutter-sizer { width: 0; }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/masonry/4.2.2/masonry.pkgd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/5.0.0/imagesloaded.pkgd.min.js"></script>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê</a>
    <div class="photo-grid" id="mediaGrid">
        <div class="grid-sizer"></div>
        <div class="gutter-sizer"></div>
    </div>

    <script>
        // Cloudinary configuration
        const CLOUDINARY_CLOUD_NAME = 'do7udtgro';
        
        // Media data - this could be in a separate file
        const mediaData = {
          "2024-10-00": [
            { 
              type: 'video', 
              format: 'avi',
              id: 'DSCF5441_bpdwgb',
              folder: '2024-10-00',
              description: 'Video 1'
            },
            { 
              type: 'video', 
              format: 'avi',
              id: 'DSCF5443_jbnwm7',
              folder: '2024-10-00',
              description: 'Video 2'
            },
            { 
              type: 'video', 
              format: 'avi',
              id: 'DSCF5442_nwkbb5',
              folder: '2024-10-00',
              description: 'Video 3'
            },
            { 
              type: 'video', 
              format: 'avi',
              id: 'DSCF5419_tk0vgs',
              folder: '2024-10-00',
              description: 'Video 4'
            },
            { 
              type: 'video', 
              format: 'avi',
              id: 'DSCF5418_gk01wt',
              folder: '2024-10-00',
              description: 'Video 5'
            },
            { 
              type: 'video', 
              format: 'avi',
              id: 'DSCF5445_gzkrrw',
              folder: '2024-10-00',
              description: 'Video 6'
            },
            { 
              type: 'video', 
              format: 'avi',
              id: 'DSCF5417_nulhbc',
              folder: '2024-10-00',
              description: 'Video 7'
            },
            { 
              type: 'video', 
              format: 'avi',
              id: 'DSCF5421_bzdhpu',
              folder: '2024-10-00',
              description: 'Video 8'
            }
          ]
        };
        
        // Helper function to get Cloudinary URLs
        function getCloudinaryUrl(item, options = {}) {
          const transformations = options.transformations || 'q_auto';
          const resourceType = item.type === 'video' ? 'video' : 'image';
          
          // For videos, convert to MP4 for web compatibility
          const formatParam = resourceType === 'video' ? 'f_mp4' : '';
          const transformString = formatParam ? `${transformations},${formatParam}` : transformations;
          
          return `https://res.cloudinary.com/${CLOUDINARY_CLOUD_NAME}/${resourceType}/upload/${transformString}/${item.folder}/${item.id}`;
        }

        function loadMedia() {
            const grid = document.getElementById('mediaGrid');
            const date = '2024-10-00'; // Change this to load media from different dates
            const dateMedia = mediaData[date];
            
            if (!dateMedia) {
                console.error(`No media found for date: ${date}`);
                return;
            }
            
            dateMedia.forEach(item => {
                const wrapper = document.createElement('div');
                wrapper.className = 'grid-item';
                
                if (item.type === 'video') {
                    const videoContainer = document.createElement('div');
                    videoContainer.className = 'video-container';
                    
                    const videoElement = document.createElement('video');
                    // Generate Cloudinary video URL with MP4 conversion for web compatibility
                    videoElement.src = getCloudinaryUrl(item, { transformations: 'q_auto' });
                    videoElement.controls = true;
                    videoElement.muted = true;
                    videoElement.preload = 'metadata'; // Just load metadata initially for performance
                    videoElement.playsInline = true;
                    
                    // Generate thumbnail (Cloudinary automatically generates these)
                    const thumbnailUrl = getCloudinaryUrl(item, { 
                      transformations: 'q_auto,w_640,h_360,c_pad',
                      format: 'jpg'
                    }).replace('/video/upload/', '/video/upload/so_auto,du_1/');
                    
                    videoElement.poster = thumbnailUrl;
                    
                    // Play when in view
                    const observer = new IntersectionObserver((entries) => {
                      entries.forEach(entry => {
                        if (entry.isIntersecting) {
                          videoElement.play().catch(e => console.log("Autoplay prevented:", e));
                        } else {
                          videoElement.pause();
                        }
                      });
                    }, { threshold: 0.5 });
                    
                    videoElement.addEventListener('loadedmetadata', () => {
                        if (videoElement.videoHeight > videoElement.videoWidth) {
                            videoContainer.classList.add('vertical');
                        } else {
                            videoContainer.classList.add('horizontal');
                        }
                        const aspectRatio = (videoElement.videoHeight / videoElement.videoWidth) * 100;
                        videoContainer.style.paddingTop = `${aspectRatio}%`;
                        if (msnry) msnry.layout();
                    });
                    
                    videoContainer.appendChild(videoElement);
                    wrapper.appendChild(videoContainer);
                    
                    // Add description if available
                    if (item.description) {
                        const descElement = document.createElement('div');
                        descElement.className = 'media-description';
                        descElement.textContent = item.description;
                        wrapper.appendChild(descElement);
                    }
                    
                    // Start observing once added to DOM
                    setTimeout(() => observer.observe(videoElement), 100);
                } else {
                    const imgElement = document.createElement('img');
                    // Generate Cloudinary image URL with optimizations
                    imgElement.src = getCloudinaryUrl(item, { transformations: 'q_auto,f_auto' });
                    imgElement.alt = item.description || item.id;
                    
                    wrapper.appendChild(imgElement);
                    
                    // Add description if available
                    if (item.description) {
                        const descElement = document.createElement('div');
                        descElement.className = 'media-description';
                        descElement.textContent = item.description;
                        wrapper.appendChild(descElement);
                    }
                }
                
                grid.appendChild(wrapper);
            });

            let msnry;

            imagesLoaded(grid, function() {
                msnry = new Masonry(grid, {
                    itemSelector: '.grid-item',
                    columnWidth: '.grid-sizer',
                    gutter: '.gutter-sizer',
                    percentPosition: true,
                    transitionDuration: 0
                });
            });

            // Periodically relayout as videos load
            let layoutCount = 0;
            const layoutInterval = setInterval(() => {
                if (msnry && layoutCount < 10) {
                    msnry.layout();
                    layoutCount++;
                } else {
                    clearInterval(layoutInterval);
                }
            }, 1000);
        }

        window.onload = loadMedia;
    </script>
</body>
</html>
