<!DOCTYPE html>
<html>
<head>
    <title>Page 1</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            font-weight: 100;
            background-color: white;
            margin: 0;
            padding: 40px;
            margin-top: 30px;
        }

        .photo-grid {
            margin: 20px auto;
            max-width: 1400px;
        }
        
        .grid-sizer,
        .grid-item {
            width: 32%;
        }
        
        .gutter-sizer {
            width: 2%;
        }
        
        .grid-item {
            margin-bottom: 20px;
            float: left;
            position: relative;
            overflow: hidden;
        }
        
        /* Default aspect ratio container */
        .video-container {
            position: relative;
            width: 100%;
            height: 0;
            overflow: hidden;
        }
        
        /* Vertical video container */
        .video-container.vertical {
            padding-top: 177.78%; /* 9:16 aspect ratio */
        }
        
        /* Horizontal video container */
        .video-container.horizontal {
            padding-top: 56.25%; /* 16:9 aspect ratio */
        }
        
        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain; /* Changed to contain to prevent cropping */
        }
        
        .grid-item img {
            display: block;
            width: 100%;
            height: auto;
        }
        
        .back-link {
            position: fixed;
            top: 40px;
            left: 40px;
            text-decoration: none;
            font-size: 24px;
            z-index: 1000;
            color: black;
        }

        @media (max-width: 1200px) {
            .grid-sizer,
            .grid-item {
                width: 48%;
            }
            .gutter-sizer {
                width: 4%;
            }
        }

        @media (max-width: 768px) {
            .grid-sizer,
            .grid-item {
                width: 100%;
            }
            .gutter-sizer {
                width: 0;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/masonry/4.2.2/masonry.pkgd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/5.0.0/imagesloaded.pkgd.min.js"></script>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê</a>
    <div class="photo-grid" id="mediaGrid">
        <div class="grid-sizer"></div>
        <div class="gutter-sizer"></div>
    </div>

    <script>
        // Cloudinary configuration
        const CLOUDINARY_CLOUD_NAME = 'do7udtgro';
        const CLOUDINARY_URL = `https://res.cloudinary.com/${CLOUDINARY_CLOUD_NAME}/image/upload/`;
        const CLOUDINARY_VIDEO_URL = `https://res.cloudinary.com/${CLOUDINARY_CLOUD_NAME}/video/upload/`;
        
        const mediaOrder = [
            { type: 'jpg', index: '2' },
            { type: 'jpg', index: '3' },
            { type: 'jpg', index: '6' },
            { type: 'mp4', index: '9' },
            { type: 'jpg', index: '5' },
            { type: 'jpg', index: '4' },
            { type: 'jpg', index: '7' }
        ];

        function loadMedia() {
            const grid = document.getElementById('mediaGrid');
            const date = '2024-06-00';
            const folderPath = `gallery/${date}`; // This should match your Cloudinary folder structure
            
            mediaOrder.forEach(item => {
                const wrapper = document.createElement('div');
                wrapper.className = 'grid-item';
                const fileName = `${date}-${item.index}`;
                
                if (item.type === 'mp4') {
                    const videoContainer = document.createElement('div');
                    videoContainer.className = 'video-container';
                    
                    const videoElement = document.createElement('video');
                    // Use Cloudinary for video with auto-formatting and quality
                    videoElement.src = `${CLOUDINARY_VIDEO_URL}/q_auto/${folderPath}/${fileName}.${item.type}`;
                    videoElement.controls = true;
                    videoElement.muted = true;
                    videoElement.autoplay = true;
                    videoElement.loop = true;
                    videoElement.preload = 'auto';
                    videoElement.playsInline = true;
                    
                    // Use Cloudinary for poster image
                    videoElement.poster = `${CLOUDINARY_URL}/q_auto/${folderPath}/${fileName}.jpg`;
                    
                    videoElement.addEventListener('canplay', () => {
                        videoElement.play().catch(e => console.log("Autoplay prevented:", e));
                    });

                    videoElement.addEventListener('loadedmetadata', () => {
                        // Determine if video is vertical or horizontal
                        if (videoElement.videoHeight > videoElement.videoWidth) {
                            videoContainer.classList.add('vertical');
                        } else {
                            videoContainer.classList.add('horizontal');
                        }
                        // Calculate exact aspect ratio if needed
                        const aspectRatio = (videoElement.videoHeight / videoElement.videoWidth) * 100;
                        videoContainer.style.paddingTop = `${aspectRatio}%`;
                        if (msnry) msnry.layout();
                    });
                    
                    videoContainer.appendChild(videoElement);
                    wrapper.appendChild(videoContainer);
                } else {
                    const imgElement = document.createElement('img');
                    // Use Cloudinary for images with optimization
                    imgElement.src = `${CLOUDINARY_URL}/q_auto,f_auto/${folderPath}/${fileName}.${item.type}`;
                    imgElement.alt = `${date}-${item.index}.jpg`;
                    
                    // Optional: Add responsive images with Cloudinary
                    imgElement.srcset = `
                        ${CLOUDINARY_URL}/q_auto,f_auto,w_400/${folderPath}/${fileName}.${item.type} 400w,
                        ${CLOUDINARY_URL}/q_auto,f_auto,w_800/${folderPath}/${fileName}.${item.type} 800w,
                        ${CLOUDINARY_URL}/q_auto,f_auto,w_1200/${folderPath}/${fileName}.${item.type} 1200w
                    `;
                    imgElement.sizes = "(max-width: 768px) 100vw, (max-width: 1200px) 48vw, 32vw";
                    
                    wrapper.appendChild(imgElement);
                }
                
                grid.appendChild(wrapper);
            });

            let msnry;

            imagesLoaded(grid, function() {
                msnry = new Masonry(grid, {
                    itemSelector: '.grid-item',
                    columnWidth: '.grid-sizer',
                    gutter: '.gutter-sizer',
                    percentPosition: true,
                    transitionDuration: 0
                });
            });

            let layoutCount = 0;
            const layoutInterval = setInterval(() => {
                if (msnry && layoutCount < 10) {
                    msnry.layout();
                    layoutCount++;
                } else {
                    clearInterval(layoutInterval);
                }
            }, 500);
        }

        window.onload = loadMedia;
    </script>
</body>
</html>
