<!DOCTYPE html>
<html>
<head>
    <title>Media Gallery</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            font-weight: 100;
            background-color: white;
            margin: 0;
            padding: 40px;
            margin-top: 30px;
        }

        .photo-grid {
            margin: 20px auto;
            max-width: 1400px;
        }
        
        .grid-sizer, .grid-item { width: 32%; }
        .gutter-sizer { width: 2%; }
        
        .grid-item {
            margin-bottom: 20px;
            float: left;
            position: relative;
            overflow: hidden;
        }
        
        .video-container {
            position: relative;
            width: 100%;
            height: 0;
            overflow: hidden;
            padding-top: 56.25%; /* Default 16:9 aspect ratio */
        }
        
        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            background-color: #f0f0f0;
        }
        
        .grid-item img {
            display: block;
            width: 100%;
            height: auto;
        }
        
        .back-link {
            position: fixed;
            top: 40px;
            left: 40px;
            text-decoration: none;
            font-size: 24px;
            z-index: 1000;
            color: black;
        }

        @media (max-width: 1200px) {
            .grid-sizer, .grid-item { width: 48%; }
            .gutter-sizer { width: 4%; }
        }

        @media (max-width: 768px) {
            .grid-sizer, .grid-item { width: 100%; }
            .gutter-sizer { width: 0; }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/masonry/4.2.2/masonry.pkgd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/5.0.0/imagesloaded.pkgd.min.js"></script>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê</a>
    <div class="photo-grid" id="mediaGrid">
        <div class="grid-sizer"></div>
        <div class="gutter-sizer"></div>
    </div>

    <script>
        // Cloudinary configuration
        const CLOUDINARY_CLOUD_NAME = 'do7udtgro';
        
        // Media items using public IDs (not full URLs)
        const mediaItems = [
            {
                type: 'image',
                publicId: '2024-06-00-6_ao5mtl'
            },
            // Add more items as needed in this format:
            // {
            //     type: 'image',  // or 'video'
            //     publicId: 'your-public-id-here'
            // },
        ];

        // Helper function to get Cloudinary URLs from public IDs
        function getCloudinaryUrl(item) {
            const resourceType = item.type || 'image';
            const format = item.format || (resourceType === 'video' ? 'mp4' : 'jpg');
            const transformations = 'q_auto' + (resourceType === 'video' ? ',f_mp4' : ',f_auto');
            
            return `https://res.cloudinary.com/${CLOUDINARY_CLOUD_NAME}/${resourceType}/upload/${transformations}/${item.publicId}`;
        }

        function loadMedia() {
            const grid = document.getElementById('mediaGrid');
            
            mediaItems.forEach(item => {
                const wrapper = document.createElement('div');
                wrapper.className = 'grid-item';
                
                if (item.type === 'video') {
                    const videoContainer = document.createElement('div');
                    videoContainer.className = 'video-container';
                    
                    const videoElement = document.createElement('video');
                    videoElement.src = getCloudinaryUrl(item);
                    videoElement.controls = true;
                    videoElement.muted = true;
                    videoElement.preload = 'metadata';
                    videoElement.playsInline = true;
                    
                    // Create thumbnail URL
                    const thumbnailItem = {
                        type: 'image',
                        publicId: item.publicId,
                        format: 'jpg'
                    };
                    videoElement.poster = getCloudinaryUrl(thumbnailItem);
                    
                    // Play when in view
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                videoElement.play().catch(e => console.log("Autoplay prevented:", e));
                            } else {
                                videoElement.pause();
                            }
                        });
                    }, { threshold: 0.5 });
                    
                    videoElement.addEventListener('loadedmetadata', () => {
                        const aspectRatio = (videoElement.videoHeight / videoElement.videoWidth) * 100;
                        videoContainer.style.paddingTop = `${aspectRatio}%`;
                        if (msnry) msnry.layout();
                    });
                    
                    videoContainer.appendChild(videoElement);
                    wrapper.appendChild(videoContainer);
                    
                    // Start observing once added to DOM
                    setTimeout(() => observer.observe(videoElement), 100);
                } else {
                    const imgElement = document.createElement('img');
                    imgElement.src = getCloudinaryUrl(item);
                    imgElement.alt = "Gallery image";
                    
                    wrapper.appendChild(imgElement);
                }
                
                grid.appendChild(wrapper);
            });

            let msnry;

            imagesLoaded(grid, function() {
                msnry = new Masonry(grid, {
                    itemSelector: '.grid-item',
                    columnWidth: '.grid-sizer',
                    gutter: '.gutter-sizer',
                    percentPosition: true,
                    transitionDuration: 0
                });
            });

            // Periodically relayout as videos/images load
            let layoutCount = 0;
            const layoutInterval = setInterval(() => {
                if (msnry && layoutCount < 10) {
                    msnry.layout();
                    layoutCount++;
                } else {
                    clearInterval(layoutInterval);
                }
            }, 1000);
        }

        window.onload = loadMedia;
    </script>
</body>
</html>
